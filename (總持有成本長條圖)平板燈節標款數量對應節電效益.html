<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>總持有成本長條圖</title>
    <!-- 載入 Tailwind CSS (必要) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    colors: {
                        'primary-green': '#10b981', // 祖母綠 (金鍏色)
                        'secondary-blue': '#3b82f6',
                        'light-red': '#f87171', 
                        'light-yellow': '#fbbf24', 

                        // --- 成本組成顏色 ---
                        'cost-initial': '#6B8F71',  // 初始成本 - Reseda green
                        'cost-electricity': '#EDAE49', // 電費 - Hunyadi yellow
                        'cost-repair': '#D1495B',   // 換修成本 - Amaranth
                    }
                }
            }
        }
    </script>
    <style>
        .bar-container {
            display: flex;
            align-items: flex-end;
            height: 300px;
        }
        .bar {
            transition: height 0.8s ease-out;
            cursor: pointer;
        }
        /* 確保 body 內部沒有額外的 padding/margin，方便 iframe 填滿 */
        body {
            padding: 0;
            margin: 0;
            background-color: transparent; 
        }
    </style>
</head>
<body>
    
    <!-- 
      修正說明：
      1. 手機版使用 pl-12 (48px)，減少留白。
      2. 桌機版 (sm:) 使用 pl-16 (64px)，確保空間足夠。
    -->
    <div id="chart-content" class="w-full p-4 sm:p-6 bg-white rounded-xl shadow-2xl pl-12 sm:pl-16"> 
        <h2 class="text-xl font-bold mb-4 text-gray-700">總持有成本長條圖 (NT\$)</h2>
        <div class="bar-container relative border-b border-l border-gray-300">
            
            <!-- Y 軸標籤 (成本) 
                 修正定位方式：
                 1. w-12 / sm:w-16：設定固定寬度，與父層 padding 對應。
                 2. -ml-12 / sm:-ml-16：使用負 margin 將標籤拉回 padding 區域。
                 3. text-right：確保數字靠右對齊，緊貼軸線。
            -->
            <div class="absolute inset-y-0 left-0 w-12 -ml-12 sm:w-16 sm:-ml-16 pr-2 flex flex-col justify-between text-gray-500 text-xs sm:text-sm text-right">
                <!-- 使用 flex justify-between 自動分佈上下 -->
                <div class="-mt-2">6,500</div> <!-- 微調頂部對齊 -->
                <div>4,333</div>
                <div class="-mb-2">0</div> <!-- 微調底部對齊 -->
            </div>

            <!-- 長條圖 -->
            <div id="chart-bars" class="flex flex-1 items-end h-full"></div>
        </div>

        <!-- X 軸標籤 (產品名稱) -->
        <div id="chart-labels" class="flex pt-2 text-center text-xs sm:text-sm font-semibold"></div>
    </div>


    <script>
        // 產品數據
        const productData = [
            { name: "金鍏LED平板燈 (21W)", color: 'bg-primary-green', initial: 1400, electricity: 1575, repair: 0, hoverColor: 'hover:bg-green-700' },
            { name: "市售LED平板燈 (25W)", color: 'bg-secondary-blue', initial: 500, electricity: 3000, repair: 750, hoverColor: 'hover:bg-blue-700' },
            { name: "格柵燈(T8燈管*4) (40W)", color: 'bg-light-yellow', initial: 750, electricity: 3225, repair: 800, hoverColor: 'hover:bg-yellow-600' }, 
            { name: "格柵燈(T5螢光燈管*4) (64W)", color: 'bg-light-red', initial: 750, electricity: 4800, repair: 800, hoverColor: 'hover:bg-red-700' }, 
        ];

        const chartBars = document.getElementById('chart-bars');
        const chartLabels = document.getElementById('chart-labels');
        const maxCost = 6350; // T5 的總持有成本作為最大基準

        function renderChart() {
            chartBars.innerHTML = '';
            chartLabels.innerHTML = '';

            productData.forEach((data, index) => { 
                const totalCost = data.initial + data.electricity + data.repair;
                const heightPercentage = (totalCost / maxCost) * 100;
                
                const barDiv = document.createElement('div');
                const borderColorClass = index === 0 ? 'border-2 border-primary-green/70 ring-2 ring-primary-green/50' : '';
                barDiv.className = `bar w-1/4 h-0 mx-1 md:mx-2 flex flex-col justify-end items-center rounded-t-lg ${data.color} relative group shadow-lg ${borderColorClass}`;
                barDiv.style.height = `${heightPercentage}%`;
                barDiv.style.minHeight = '10px';
                
                // --- 賺! 圖示 ---
                if (index === 0) {
                    const profitIconDiv = document.createElement('div');
                    // 修正 positioning
                    profitIconDiv.className = 'absolute right-1/2 translate-x-1/2 w-12 h-12 rounded-full bg-cost-repair flex items-center justify-center shadow-2xl z-30 transform hover:scale-110 transition-transform duration-300 border-4 border-white top-[-110px]'; 
                    profitIconDiv.innerHTML = '<span class="text-2xl font-black text-white">賺!</span>';
                    barDiv.appendChild(profitIconDiv);
                }
                
                const totalCostLabel = document.createElement('div');
                totalCostLabel.className = 'absolute top-0 transform -translate-y-full mt-1 font-bold text-xs sm:text-sm text-gray-800 bg-white px-1 py-0.5 rounded shadow-md z-20 whitespace-nowrap';
                totalCostLabel.innerHTML = `NT$ ${totalCost.toLocaleString()}`;
                barDiv.appendChild(totalCostLabel);

                const costs = [
                    { value: data.repair, label: '5年換修', color: 'bg-cost-repair' }, 
                    { value: data.electricity, label: '5年電費', color: 'bg-cost-electricity' },
                    { value: data.initial, label: '初始成本', color: 'bg-cost-initial' }
                ];

                costs.forEach(cost => {
                    if (cost.value > 0) {
                        const segmentHeight = (cost.value / totalCost) * 100;
                        const segmentDiv = document.createElement('div');
                        segmentDiv.className = `${cost.color} w-full transition-all duration-700 ease-out relative group/segment`;
                        segmentDiv.style.height = `${segmentHeight}%`;
                        
                        const segmentTooltip = document.createElement('div');
                        segmentTooltip.className = 'absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold rounded opacity-0 group-hover/segment:opacity-100 transition-opacity whitespace-nowrap z-30 bg-black/60 backdrop-blur-[1px]';
                        segmentTooltip.innerHTML = `${cost.label}: ${cost.value.toLocaleString()} 元`;
                        
                        segmentDiv.appendChild(segmentTooltip);
                        
                        barDiv.appendChild(segmentDiv); 
                    }
                });
                
                chartBars.appendChild(barDiv);

                const labelDiv = document.createElement('div');
                labelDiv.className = 'w-1/4 px-1 md:px-2 truncate';
                const shortNameMap = {
                    "金鍏LED平板燈 (21W)": "金鍏LED平板燈",
                    "市售LED平板燈 (25W)": "市售LED平板燈",
                    "格柵燈(T8燈管*4) (40W)": "格柵燈(LED T8)",
                    "格柵燈(T5螢光燈管*4) (64W)": "格柵燈(T5)",
                };
                labelDiv.textContent = shortNameMap[data.name] || data.name.split(' ')[0]; 
                labelDiv.title = data.name; 
                chartLabels.appendChild(labelDiv);
            });
        }

        window.onload = renderChart;
    </script>
</body>
</html>