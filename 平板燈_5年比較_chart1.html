<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>照明總成本長條圖</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    colors: {
                        'primary-green': '#10b981',
                        'secondary-blue': '#3b82f6',
                        'light-red': '#f87171', 
                        'light-yellow': '#fbbf24', 
                        'cost-initial': '#6B8F71',  
                        'cost-electricity': '#EDAE49',
                        'cost-repair': '#D1495B',   
                    }
                }
            }
        }
    </script>
    <style>
        body {
            padding: 0; 
            margin: 0; 
            overflow-x: hidden; /* 允許垂直滾動，但防止水平滾動 */
            font-family: 'Inter', 'Noto Sans TC', 'sans-serif';
            background-color: transparent; 
        }

        .bar-container {
            display: flex;
            align-items: flex-end;
            height: 300px;
            /* 預留左側空間給 Y 軸標籤 */
            margin-left: 3rem; 
        }

        .bar {
            transition: height 0.8s ease-out;
            cursor: pointer;
        }

        /* 修正 Y 軸標籤定位：現在它們位於 bar-container 的左側邊界 */
        .y-axis-labels {
            position: absolute;
            top: 0;
            /* 將 Y 軸定位在圖表區域的左上角 */
            left: 0; 
            height: 100%;
            /* 讓標籤位於圖表邊界左側的 3rem 空間內 */
            margin-left: 0.5rem; 
            color: #6b7280; 
            z-index: 10; 
            pointer-events: none;
        }
        .y-axis-labels > div {
            position: absolute;
            right: 100%; /* 讓數字貼著 Y 軸左邊 */
            padding-right: 0.5rem; /* 數字和 Y 軸線的間隔 */
            white-space: nowrap;
            font-size: 0.875rem;
            transform: translateY(-50%); /* 確保垂直居中 */
        }
        .y-axis-labels > div:first-child { top: 0; } 
        .y-axis-labels > div:nth-child(2) { top: 33.333333%; } 
        .y-axis-labels > div:last-child { bottom: 0; } 

    </style>
</head>
<body>
    <div id="chart-widget" class="relative p-0 m-0 w-full h-full">
        
        <h2 class="text-xl font-bold mb-4 text-gray-700 ml-12">５年總持有成本長條圖 (NT$)</h2>
        
        <div class="bar-container relative border-b border-l border-gray-300">
            
            <div class="y-axis-labels">
                <div>6,000</div>
                <div>4,000</div>
                <div>0</div>
            </div>

            <div id="chart-bars" class="flex flex-1 items-end h-full">
                </div>
        </div>

        <div id="chart-labels" class="flex pt-2 text-center text-xs sm:text-sm font-semibold ml-12">
            </div>

    </div>

    <script>
        const productData = [
            { name: "金鍏LED平板燈 (21W)", color: 'bg-primary-green', initial: 1400, electricity: 1533, repair: 0, hoverColor: 'hover:bg-green-700' },
            { name: "市售LED平板燈 (25W)", color: 'bg-secondary-blue', initial: 500, electricity: 1825, repair: 2000, hoverColor: 'hover:bg-blue-700' },
            { name: "格柵燈(T8燈管*4) (40W)", color: 'bg-light-yellow', initial: 600, electricity: 2920, repair: 2200, hoverColor: 'hover:bg-yellow-600' }, 
            { name: "格柵燈(T5螢光燈管*4) (44W)", color: 'bg-light-red', initial: 600, electricity: 3212, repair: 2200, hoverColor: 'hover:bg-red-700' },
        ];

        const chartBars = document.getElementById('chart-bars');
        const chartLabels = document.getElementById('chart-labels');
        const maxCost = 6012; 

        function renderChart() {
            if (!chartBars || !chartLabels) return; 

            chartBars.innerHTML = '';
            chartLabels.innerHTML = '';

            productData.forEach((data, index) => { 
                const totalCost = data.initial + data.electricity + data.repair;
                const heightPercentage = (totalCost / maxCost) * 100;
                
                const barDiv = document.createElement('div');
                const borderColorClass = index === 0 ? 'border-2 border-primary-green/70 ring-2 ring-primary-green/50' : '';
                
                barDiv.className = `bar w-1/4 h-0 mx-2 flex flex-col justify-end items-center rounded-t-lg ${data.color} relative group shadow-lg ${borderColorClass}`;
                barDiv.style.height = `${heightPercentage}%`;
                barDiv.style.minHeight = '10px'; 
                
                if (index === 0) {
                    const profitIconDiv = document.createElement('div');
                    profitIconDiv.className = 'absolute right-1/2 translate-x-1/2 w-12 h-12 rounded-full bg-cost-repair flex items-center justify-center shadow-2xl z-30 transform hover:scale-110 transition-transform duration-300 border-4 border-white top-[-70px]';
                    profitIconDiv.innerHTML = '<span class="text-2xl font-black text-white">賺!</span>';
                    barDiv.appendChild(profitIconDiv);
                }
                
                const totalCostLabel = document.createElement('div');
                totalCostLabel.className = 'absolute top-0 transform -translate-y-full mt-1 font-bold text-xs sm:text-sm text-gray-800 bg-white px-1 py-0.5 rounded shadow-md z-20 whitespace-nowrap';
                totalCostLabel.innerHTML = `NT$ ${totalCost.toLocaleString()}`;
                barDiv.appendChild(totalCostLabel);

                const costs = [
                    { value: data.repair, label: '5年換修', color: 'bg-cost-repair' }, 
                    { value: data.electricity, label: '5年電費', color: 'bg-cost-electricity' },
                    { value: data.initial, label: '初始成本', color: 'bg-cost-initial' }
                ];

                costs.forEach(cost => {
                    if (cost.value > 0) {
                        const segmentHeight = (cost.value / totalCost) * 100;
                        const segmentDiv = document.createElement('div');
                        segmentDiv.className = `${cost.color} w-full transition-all duration-700 ease-out relative group/segment`;
                        segmentDiv.style.height = `${segmentHeight}%`;
                        
                        const segmentTooltip = document.createElement('div');
                        segmentTooltip.className = 'absolute inset-0 flex items-center justify-center text-[10px] sm:text-xs text-white font-semibold rounded opacity-0 group-hover/segment:opacity-100 transition-opacity whitespace-nowrap z-30 bg-black/60 backdrop-blur-[1px]';
                        segmentTooltip.innerHTML = `${cost.label}: ${cost.value.toLocaleString()} 元`;
                        
                        segmentDiv.appendChild(segmentTooltip);
                        barDiv.appendChild(segmentDiv); 
                    }
                });
                
                chartBars.appendChild(barDiv);

                const labelDiv = document.createElement('div');
                // !!! 修正：移除 truncate 類別
                labelDiv.className = 'w-1/4 px-2'; 
                
                // !!! 修正：直接顯示完整的產品名稱，而不是只取括號前的部分
                labelDiv.textContent = data.name; 
                
                labelDiv.title = data.name; 
                chartLabels.appendChild(labelDiv);
            });
        }

        document.addEventListener('DOMContentLoaded', renderChart);
        if (document.readyState === 'complete') {
            renderChart();
        }
    </script>
</body>
</html>
